%function [fvec,J] = osb2(n,m,x,opt)
% **************************************************************
% **************************************************************
%
%  Function [fvec,J] = osb2(n,m,x,opt)
%  Osborne 2 function      [19]
%  Dimensions:  n=11, m=65
%  Standard starting point: (1.3,0.65,0.7,0.6,3,5,7,2,4.5,5.5)
%  Minima of f=4.01377...10^(-2) 
%  at (1.31,.4315,.6336,.5993,.7539,.9056,1.3651,4.8248,2.3988,
%       4.5689,5.6754)
%
%  Revised   11/94              Plk
% **************************************************************
function [fvec,J] = osb2(a)
       % global FIRSTIME y;

	%if (FIRSTIME)
	 y  = [1.366  1.191  1.112  1.013  .991 
        	.885  .831  .847  .786 .725 
         	.746   .679   .608  .655  .616  
             	.606  .602  .626    .651  .724 
             	.649   .649  .694  .644  .624  
             	.661  .612   .558  .533  .495 
               	.500  .423  .395  .375  .372  
            	.391  .396   .405   .428   .429  
              	.523  .562  .607  .653  .672  
           	.708   .633   .668   .645  .632  
              	.591  .559  .597  .625  .739  
              	.710   .729   .720  .636  .581  
              	.428  .292  .162  .098   .054 ]';
%	 FIRSTIME=0;
%	end; 
%{            
for i = 1:m
        t(i) = (i-1)/10;
	t09= t(i)-x(9);
	t10= t(i)-x(10);
	t11= t(i)-x(11);
	s09= t09^2;
	s10= t10^2;
	s11= t11^2;
	e1= exp(-t(i)*x(5));
	e2= exp(-s09*x(6));
	e3= exp(-s10*x(7));
	e4=exp(-s11*x(8));

    if((opt==1) | (opt==3))
        fvec(i) = (x(1)*e1 + x(2)*e2 + x(3)*e3 + x(4)*e4)-y(i);
    else fvec='?';
    end;
        
    if((opt==2) | (opt==3))
         r2=x(2)*e2;
         r3=x(3)*e3;
         r4=x(4)*e4;

        J(i,1)=e1;
        J(i,2)=e2;
        J(i,3)=e3;
        J(i,4)=e4;
        J(i,5)=-t(i)*x(1)*e1;
        J(i,6)= -s09*r2;
        J(i,7)= -s10*r3;
	J(i,8)= -s11*r4;
	J(i,9)= 2*t09*x(6)*r2;
	J(i,10)=2*t10*x(7)*r3;
	J(i,11)=2*t11*x(8)*r4;
else J='?';
    end;

end;

fvec=fvec';

if((opt<1) | (opt>3))
        disp('Error: Option value sent to OSB2.M is either <1 or >3');
end;


%x0 = [1.3,.65,.65,.7,.6,3,5,7,2,4.5,5.5]' ;
%}
values=zeros(65,12);
x1=valder(a(1),[1 0 0 0 0 0 0 0 0 0 0]);
x2=valder(a(2),[0 1 0 0 0 0 0 0 0 0 0]);
x3=valder(a(3),[0 0 1 0 0 0 0 0 0 0 0]);
x4=valder(a(4),[0 0 0 1 0 0 0 0 0 0 0]);
x5=valder(a(5),[0 0 0 0 1 0 0 0 0 0 0]);
x6=valder(a(6),[0 0 0 0 0 1 0 0 0 0 0]);
x7=valder(a(7),[0 0 0 0 0 0 1 0 0 0 0]);
x8=valder(a(8),[0 0 0 0 0 0 0 1 0 0 0]);
x9=valder(a(9),[0 0 0 0 0 0 0 0 1 0 0]);
x10=valder(a(10),[0 0 0 0 0 0 0 0 0 1 0]);
x11=valder(a(11),[0 0 0 0 0 0 0 0 0 0 1]);
for i = 1:65
        t(i) = (i-1)/10;
	t09(i)= t(i)-x9;
	t10(i)= t(i)-x10;
	t11(i)= t(i)-x11;
	s09(i)= t09(i)^2;
	s10(i)= t10(i)^2;
	s11(i)= t11(i)^2;
	s1(i)=-s09(i);
	s2(i)=-s10(i);
	s3(i)=-s11(i);
	m(i)= -t(i);
	m1(i)= m(i)*x5;
	m2(i)= s1(i)*x6;
	m3(i)= s2(i)*x7;
	m4(i)= s3(i)*x8;
	e1(i)= exp(m1(i));
	e2(i)= exp(m2(i));
	e3(i)= exp(m3(i));
	e4(i)= exp(m4(i));
	v1(i)=x1*e1(i);
	v2(i)=x2*e2(i);
	v3(i)=x3*e3(i);
	v4(i)=x4*e4(i);
	v5(i)=v1(i)+v2(i);
	v6(i)=v3(i)+v4(i);
	v7(i)=v5(i)+v6(i);
        f(i) = y(i)-v7(i);
	values(i,:) = [double(f(i))];
end
F = values(:,1)
J = values(:,2:12)
